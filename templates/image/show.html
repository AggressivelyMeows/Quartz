{% extends 'imports.html' %}
{% block head %}
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@Quartz_" />
<meta name="twitter:title" content="{{image_meta.title or 'Quartz Image'}}" />
<meta name="twitter:description" content="{{db.get_tags_string(image_meta.tags)}}" />
<meta name="twitter:image" content="/api/image/{{image_meta.fileID}}" />
{% endblock %}
{% block sidebar %}
<div class="column is-3">
    {{search_bar()}}
    <h1 class="subtitle is-5" style="margin:0;padding:0;">Tags</h1>
    <br />
    <script>
        function like_tag(tagID) {
            $.ajax({ url: '/api/tags/' + tagID + '/like' }).done(function (resp) {
                if (resp['success']) {
                    show_notification('You have liked this tag', 'is-success');
                } else {
                    show_notification(resp['msg'], 'is-success');
                }
            })
        }
        function unlike_tag(tagID) {
            $.ajax({ url: '/api/tags/' + tagID + '/unlike' }).done(function (resp) {
                if (resp['success']) {
                    show_notification('You have unliked this tag', 'is-success');
                } else {
                    show_notification(resp['msg'], 'is-success');
                }
            })
        }
    </script>

    <div style="display:flex;flex-flow:column">
        {{ tag_list(image_meta.tags, column=True) }}
    </div>
    <hr />
    <h1 class="subtitle is-5">Info</h1>
    {% with author = db.get_user(image_meta.userID) %}
    <a href="/profile/{{author.userID}}"><b>Uploaded by: {{author.username}}</b></a>
    {% endwith %}
    <p><b>Uploaded: {{image_meta.uploaded_at}}</b></p>
    <p><b>Views: {{image_meta.views|length}}</b></p>
    <hr />
    {% if is_logged_in %}
    {% if user.role.has("delete_image") %}
    <a href="/api/image/{{image_meta.fileID}}/delete">Delete image</a>
    {% endif %}
    {% endif %}
</div>

{% endblock %}
{% block content %}
{% with author = get_user(image_meta['userID']) %}
<div class="" style="display:flex;align-items:center;justify-content:center;width:100%;">
    <img id="img" src="/api/image/{{image_meta.fileID}}" class="image" style="height:100%;width:100%;max-width:825px;" />
</div>
<hr />
<div class="box">
    <h1 class="subtitle">Comments</h1>
    <p>Coming soon</p>
</div>
{% endwith %}
{% endblock %}